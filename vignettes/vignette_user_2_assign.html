<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Kenneth McLean" />
<meta name="author" content="Riinu Ots" />

<meta name="date" content="2018-08-24" />

<title>Redcap User Management: 2. Automatically Assign User Rights</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Redcap User Management: 2. Automatically Assign User Rights</h1>
<h4 class="author"><em>Kenneth McLean</em></h4>
<h4 class="author"><em>Riinu Ots</em></h4>
<h4 class="date"><em>2018-08-24</em></h4>



<p>To be able to use a REDCap project, two components are required:</p>
<ol style="list-style-type: decimal">
<li><p><strong>User account</strong> - This username allows the user to log onto the REDCap instance.</p></li>
<li><p><strong>User rights</strong> - This is required to access a specific REDCap project, and determines the capabilities the user has (e.g. to access certain forms, to be restricted to a specific data access group, to import/export data, etc)</p></li>
</ol>
<p>Management of user rights in REDCap becomes increasingly laborious as the scale of the research project expands (e.g. with the number of users, and the number of data access groups). However, at present, REDCap does not directly support mass-allocation of user rights within a project.</p>
<p>The aim of the following vignetee is to describe a workflow by which users can be easily automatically assigned within a REDCap project</p>
<div id="assign-user-access" class="section level1">
<h1>Assign user access</h1>
<div id="assign-new-user-rights" class="section level2">
<h2>1. Assign new user rights</h2>
<p>The automatic assignment of user rights and allocation to data access groups (DAG) has several important advantages over the manual method:</p>
<ul>
<li><p>Once set-up, it involves a fraction of the time and labour (compared to doing so manually), and can be easily repeated using R. This enables multicentre research using REDCap to become easily scalable irrespective of the number of users and number of data access groups.</p></li>
<li><p>It signficantly reduces allocation errors (e.g. users being allocated to incorrect DAGs).</p></li>
</ul>
<p>However, the downside using this method is that “user roles” cannot be assigned from outwith REDCap. Therefore, each user is automatically allocated their rights on an individual basis. This has implications that this method must be used throughout the lifespan of the project to edit current user rights (rather than simply editing those of the “user role” on REDCap).</p>
<p>The assignment of new user rights can be achieved via the following steps:</p>
<div id="a.-user_new" class="section level3">
<h3>a). <code>user_new()</code></h3>
<p>The <code>user_new()</code> function can be used to compare a dataframe of all users to those currently allocated on REDCap to determine any new users requiring assigned (ignoring those listed in <code>users_exception</code>).</p>
<p>These new users can then be uploaded to REDCap using <code>user_import()</code> and <code>user_assign()</code>.</p>
</div>
<div id="b.-user_import" class="section level3">
<h3>b). <code>user_import()</code></h3>
<p>REDCap user accounts cannot be generated via R at present, and need to be manually uploaded at present (however there is capability to bulk upload via a csv file). This function can be used to generate the csv file in the exact format required for direct upload via the control centre.</p>
<p>It requires a dataframe of at least 4 mandatory columns (corresponding to: username, first name, last name, and email address) and 4 optional columns (corresponding to: institution, sponser, expiration, comments). All optional columns will be blank unless otherwise specified.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"># Example output from user_roles_n()</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">data_user_import &lt;-<span class="st"> </span>collaborator<span class="op">::</span>example_user_roles_n_full <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(username, email, firstname, lastname, data_access_group) <span class="co"># please note all names are randomly generated</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">collaborator<span class="op">::</span><span class="kw">user_import</span>(<span class="dt">df =</span> data_user_import,</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">            <span class="dt">username =</span> <span class="st">&quot;username&quot;</span>, <span class="dt">first_name =</span> <span class="st">&quot;firstname&quot;</span>, <span class="dt">last_name =</span> <span class="st">&quot;lastname&quot;</span>,</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">            <span class="dt">email =</span> <span class="st">&quot;email&quot;</span>, <span class="dt">institution =</span> <span class="st">&quot;data_access_group&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Username</th>
<th align="left">First name</th>
<th align="left">Last name</th>
<th align="left">Email address</th>
<th align="left">Institution ID</th>
<th align="left">Sponsor username</th>
<th align="left">Expiration</th>
<th align="left">Comments</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">f_almond</td>
<td align="left">Fleur</td>
<td align="left">Almond</td>
<td align="left"><a href="mailto:f_almond@email.com">f_almond@email.com</a></td>
<td align="left">NA</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">y_andersen</td>
<td align="left">Yaseen</td>
<td align="left">Andersen</td>
<td align="left"><a href="mailto:y_andersen@email.com">y_andersen@email.com</a></td>
<td align="left">NA</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">k_ashton</td>
<td align="left">Kester</td>
<td align="left">Ashton</td>
<td align="left"><a href="mailto:k_ashton@email.com">k_ashton@email.com</a></td>
<td align="left">NA</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">c_avila</td>
<td align="left">Chanice</td>
<td align="left">Avila</td>
<td align="left"><a href="mailto:c_avila@email.com">c_avila@email.com</a></td>
<td align="left">NA</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">s_ayala</td>
<td align="left">Samiha</td>
<td align="left">Ayala</td>
<td align="left"><a href="mailto:s_ayala@email.com">s_ayala@email.com</a></td>
<td align="left">NA</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">a_barker</td>
<td align="left">Aleesha</td>
<td align="left">Barker</td>
<td align="left"><a href="mailto:a_barker@email.com">a_barker@email.com</a></td>
<td align="left">hospital_A</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">s_beech</td>
<td align="left">Shanelle</td>
<td align="left">Beech</td>
<td align="left"><a href="mailto:s_beech@email.com">s_beech@email.com</a></td>
<td align="left">hospital_B</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">h_berry</td>
<td align="left">Hailie</td>
<td align="left">Berry</td>
<td align="left"><a href="mailto:h_berry@email.com">h_berry@email.com</a></td>
<td align="left">hospital_B</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">a_bowen</td>
<td align="left">Alyssa</td>
<td align="left">Bowen</td>
<td align="left"><a href="mailto:a_bowen@email.com">a_bowen@email.com</a></td>
<td align="left">hospital_C</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">r_bradford</td>
<td align="left">Ralph</td>
<td align="left">Bradford</td>
<td align="left"><a href="mailto:r_bradford@email.com">r_bradford@email.com</a></td>
<td align="left">hospital_C</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">y_cameron</td>
<td align="left">Yara</td>
<td align="left">Cameron</td>
<td align="left"><a href="mailto:y_cameron@email.com">y_cameron@email.com</a></td>
<td align="left">hospital_D</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">m_cantrell</td>
<td align="left">Meg</td>
<td align="left">Cantrell</td>
<td align="left"><a href="mailto:m_cantrell@email.com">m_cantrell@email.com</a></td>
<td align="left">hospital_D</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">a_carlson</td>
<td align="left">Ayomide</td>
<td align="left">Carlson</td>
<td align="left"><a href="mailto:a_carlson@email.com">a_carlson@email.com</a></td>
<td align="left">hospital_A</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">m_carrillo</td>
<td align="left">Martha</td>
<td align="left">Carrillo</td>
<td align="left"><a href="mailto:m_carrillo@email.com">m_carrillo@email.com</a></td>
<td align="left">hospital_B</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">l_cervantes</td>
<td align="left">Leroy</td>
<td align="left">Cervantes</td>
<td align="left"><a href="mailto:l_cervantes@email.com">l_cervantes@email.com</a></td>
<td align="left">hospital_D</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
<div id="c.-user_assign" class="section level3">
<h3>c). <code>user_assign()</code></h3>
<p>This can be achieved via the following steps:</p>
<p><strong>1. Create example user (with the desired user rights):</strong></p>
<ul>
<li>This should be done within REDCap - users which act as an example of each role in the project (e.g. administrator, collaborator, validator) should be manually created as normal.</li>
</ul>
<p><strong>2. Create data_access_groups:</strong></p>
<ul>
<li>Data access groups should be added manually as normal.</li>
</ul>
<p><strong>3. Apply <code>user_assign()</code>:</strong></p>
<ul>
<li><p>Use the <code>user_assign()</code> function to add a group of users (<code>users.df</code>) with the same user rights as the example user (input username of the example username as <code>role</code>).</p></li>
<li><p>These usernames / user rights are directly pushed into the REDCap project (including assignment to the appropriate DAG) on an individual , but automatic / rapid basis.</p></li>
<li><p>It is highly recommended that users are grouped using <code>user_roles_n()</code> and/or <code>user_roles()</code> prior to assignment to minimise possible errors, and to use <code>user_validate()</code> to identify potential issues afterwards (e.g. to ensure form rights have uploaded correctly) (see <a href="https://github.com/kamclean/collaborator/blob/master/vignettes/vignette_user_1_explore.Rmd">Redcap User Management: 1. Explore Current Users</a>).</p></li>
</ul>
<p><em>Note: Users can be assigned to a project without being uploaded via the control centre (e.g. accounts being issued). This may be useful if a single user import is preferred over multiple smaller imports, or user access is desired to be given at a single point in time.</em></p>
<p><strong>4. Troubleshooting common errors using <code>user_assign()</code>:</strong></p>
<p>a). <em>Users are not being uploaded</em>:</p>
<ul>
<li>The most likely reason is that the DAG listed for the user is absent / incorrect. The DAG being assigned must exactly match a DAG already present on REDCap (as per step 2). Note: This does not apply in the case of DAGs listed as NA.</li>
</ul>
<p>b). <em>Users do not have the appropriate rights</em>:</p>
<ul>
<li><p>Check your example user has the correct rights, and that the correct example user and correct group are being used within the <code>user_assign()</code> function. Note: if user rights are required to be edited for whatever reason, please see the explaination below.</p></li>
<li><p>Alternatively use <code>user_validate()</code> to check the “forms” access has uploaded correctly (see <a href="https://github.com/kamclean/collaborator/blob/master/vignettes/vignette_user_1_explore.Rmd">Redcap User Management: 1. Explore Current Users</a>).</p></li>
</ul>
</div>
</div>
<div id="edit-current-user-rights" class="section level2">
<h2>2. Edit current user rights</h2>
<p>The downside to automatic user allocation using this method is that “user roles” cannot be assigned from outwith REDCap. Therefore, should the user rights of the group need to be edited afterwards it is <em>highly recommended</em> to be done via re-application of this method (otherwise each individual users would need to be allocated to a role (and then edited), or their rights would need to manually edited individually).</p>
<p>This can be achieved via the following steps:</p>
<ol style="list-style-type: decimal">
<li>Create example user (with the desired user rights):</li>
</ol>
<ul>
<li><p>The easiest method to achieve this is from within REDCap - a new user should either be allocated with the desired rights, or an existing user should be selected and their user rights amended as appropriate.</p></li>
<li><p>Alternatively this can be modified once exported to R, however this requires a clear understanding of how user rights are recorded in REDCap.</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Apply <code>user_assign()</code>:</li>
</ol>
<ul>
<li>Use the <code>user_assign()</code> function to modify the rights of a group of users (<code>users.df</code>) to match the existing example user (input username as <code>role</code>).</li>
</ul>
<p><em>Note: While user rights can be modified to remove all access to forms on the REDCap project, they cannot be removed from the project using this method (the only capability to do so is manually / individually via REDCap).</em></p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
